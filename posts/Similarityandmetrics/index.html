<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Recommendation system for E-commerce / Similarity and Metrics | Kwon_sun_cheol</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Recommendation system for E-commerce / Similarity and Metrics" /><meta name="author" content="Kwon Suncheol" /><meta property="og:locale" content="en_US" /><meta name="description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><meta property="og:description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><link rel="canonical" href="https://classicmania.github.io/posts/Similarityandmetrics/" /><meta property="og:url" content="https://classicmania.github.io/posts/Similarityandmetrics/" /><meta property="og:site_name" content="Kwon_sun_cheol" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-18T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Recommendation system for E-commerce / Similarity and Metrics" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Kwon Suncheol" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Recommendation system for E-commerce / Similarity and Metrics","description":"A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation.","datePublished":"2021-04-18T00:00:00+09:00","dateModified":"2021-04-18T00:00:00+09:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://classicmania.github.io/posts/Similarityandmetrics/"},"url":"https://classicmania.github.io/posts/Similarityandmetrics/","author":{"@type":"Person","name":"Kwon Suncheol"},"@context":"https://schema.org"}</script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script src="/assets/js/post.min.js" async></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/polymath.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Kwon_sun_cheol</a></div><div class="site-subtitle font-italic">Data lover</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/classicmania" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://classicmania33.medium.com/" target="_blank"> <i class="fab fa-medium"></i> </a> <a href="https://www.linkedin.com/in/%EC%88%9C%EC%B2%A0-%EA%B6%8C-9218a8180/" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Recommendation system for E-commerce / Similarity and Metrics</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Recommendation system for E-commerce / Similarity and Metrics</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Apr 18, 2021, 12:00 AM +0900" > Apr 18 <i class="unloaded">2021-04-18T00:00:00+09:00</i> </span> by <span class="author"> Kwon Suncheol </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 24, 2021, 11:22 AM +0900" > Apr 24 <i class="unloaded">2021-04-24T11:22:14+09:00</i> </span></div></div><div class="post-content"><p><br /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post_img/similarity_image.jpeg" alt="similarity_example" /></p><p><br /></p><blockquote><p>지난 시간에는 팀원들과 Matrix Completion과 관련된 SVD<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>, ALS<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>, SGD의 개념을 살펴보았습니다. 이번 시간에는 이커머스에서 추천 모델의 최종 단계인 유사도(Similarity)를 계산하는 부분과 지표(Metric)를 점검해보았습니다.</p></blockquote><p><br /></p><h2 id="similarity">Similarity</h2><hr /><p>상품 또는 고객을 벡터로 표현한 뒤 벡터 간의 유사도를 비교할 때 일반적으로 ‘Non-geometric measure’와 ‘Geometric measure’로 나눌 수 있습니다.</p><h3 id="non-geometric-measure">Non-geometric measure</h3><p>Non-geometric measure와 관련하여 많은 유사도 지표가 있지만 대표적으로 몇 가지 지표를 소개하면 다음과 같습니다.</p><p><br /></p><h4 id="pearson-correlation-coefficient">Pearson Correlation Coefficient</h4><p><br /></p>\[Pearson \, Correlation \, Coefficient = \sqrt{\frac{\sum^n_{i=1} (x_i - \hat{x_i}) \, \times \, (y_i - \hat{y_i})}{\sum^n_{i=1} (x_i - \hat{x_i})^2 \, \times \, \sum^n_{i=1} (y_i - \hat{y_i})^2}}\]<p><br /></p><ul><li>X가 증가할 때 Y가 증가할 수록 양의 값을 가집니다.<li>범위는 -1 ~ 1입니다.</ul><p><br /></p><h4 id="jaccard-coefficient">Jaccard Coefficient</h4><p><br /></p>\[Jaccard \, Index = J(X,Y) = \frac{|X \cap Y|}{|X \cup Y|} = \frac{|X \cap Y|}{|X| + |Y| -|X \cap Y| }\]<p><br /></p>\[Jaccard \, distance(Jaccard \, dissimilarity \, coefficient) = d(X,Y) = 1 - J(X,Y) = 1 - \frac{|X \cap Y|}{|X \cup Y|} = \frac{|X \cup Y| - |X \cap Y|}{|X \cup Y| }\]<p><br /></p><ul><li>두 개의 집합 X,Y가 있을 때, Jaccard Index는 X,Y의 교집합의 원소 갯수를 합집합의 원소 갯수로 나눈 값입니다.<li>자연스럽게 Jaccard Index는 0~1 사이의 값을 가집니다.<li>유사성을 측정하는 Jaccard Index와는 다르게 Jaccard distance는 비유사성에 관한 측도입니다.<li>Jaccard Index와 Jaccard distance는 서로 반비례 관계입니다.<li>X,Y가 공통으로 가지는 상품 또는 고객은 중요하지만, X,Y 모두 존재하지 않는 상품, 고객은 배제합니다.</ul><p><br /></p><h3 id="euclidean-similarity-vs-cosine-similarity">Euclidean Similarity vs Cosine Similarity</h3><p><br /></p><p>가장 대표적인 유사도 함수들 중 코사인 유사도와 유클리드 유사도가 있습니다. 먼저 각 유사도의 정의를 살펴보겠습니다.</p><p>유클리드와 코사인 유사도의 정의는 다음과 같습니다.</p><p><br /></p>\[Euclidean \, Similarity = \sqrt{\sum^n_{i=1} (x_i - y_i)^2}\]<p><br /></p><p><br /></p>\[Cosine \, Similarity = \frac{\sum^n_{i=1} x \bullet y}{\sqrt{\sum^n_{i=1}x \bullet x} \sqrt{\sum^n_{i=1}y \bullet y}} = V\]<p><br /></p><p>이 두 유사도간의 비교를 예시와 함께 설명한 포스트<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>가 있습니다. 보다 자세한 내용을 원하시는 분은 참고해 주세요. 결론적으로 다음을 알 수 있었습니다.</p><p><br /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post_img/Cosine_ED.png" alt="weight_image2" /><em>Euclidean and Cosine example</em></p><p><br /></p><ul><li>수식의 의미를 생각해 보았을 때 유클리드 거리 측도는 두 상품간의 각도는 고려하지 않고 두 상품 벡터가 위치한 좌표상의 거리만을 고려합니다.<li>그러므로 최소 거리인 0부터 무한대까지의 범위를 가집니다.<li>코사인 유사도를 측도로 사용할 경우 최솟값은 -1이고 최대값은 1입니다.<li>벡터의 크기를 고려하지 않고 상품의 비율을 고려하여 측정합니다.<li>위의 이미지중 첫번째 그래프에서 알 수 있듯이 코사인 유사도를 기준으로 상품 D와 다른 상품들간의 가까운 순위를 정하면 다음과 같습니다.<ul><li>상품 C = 상품 B &gt; 상품 A<li>하지만 실제로는 D를 기준으로 보았을 때 상품 C와 상품 B는 분명한 차이가 존재합니다.<li>또한 상품 A와 상품 B중 유클리드 거리 측도로 보았을 때는 상품 A가 조금 더 유사한 상품입니다.</ul><li>이렇게 어떤 유사도를 최종 단계에서 선택하느냐에 따라서 추천되는 상품이 달라질 수 있으므로 상품 유사도 간의 비교를 반드시 고려해야 합니다.</ul><p><br /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post_img/ts_ss_image.png" alt="TS and SS" /><em>TS and SS</em></p><p><br /></p><ul><li>유클리드 거리 속성과 코사인 유사도의 특징을 혼합한 지표는 만들 수 없을까요?<li>두 벡터를 기점으로 만들어지는 삼각형의 넓이를 유사도로 설정하면 어떨까요?<ul><li>SAS(Side Angle Side)[삼각형의 한 각이 다른 삼각형의 각과 합동이면서 각을 이루는 두 변의 비율이 서로 비례하면 삼각형은 유사하다]를 활용하겠습니다.<li>위의 그림처럼 N차원의 벡터(A,B)의 강도를 표현하면 다음과 같습니다.</ul><p><br /></p>\[|A| = \sqrt{\sum^N_{k=1}(A_n)^2} \, and \, |B| = \sqrt{\sum^N_{k=1}(B_n)^2}\]<p><br /></p><ul><li>코사인 유사도를 활용하여 양변 사이의 각(\(\theta)\)을 구할 수 있습니다.<li>하지만 위의 (a) 그래프에서 B,C 사이의 각이 형성되지 않습니다. 이 점을 고려하여 각(\(\hat{\theta)}\)은 다음과 같이 계산합니다.<ul><li>절대적인 숫자는 정해지지 않았지만 계산의 편리함을 위해서 10 미만은 사용하지 않습니다.</ul></ul><p><br /></p>\[\hat{\theta} = cos^{-1}(V) + 10\]<p><br /></p><ul><li>TS(Triangle’s Area Similarity)는 위의 정보들을 활용하여 다음과 같이 구할 수 있고 다음의 사실을 알 수 있습니다.<ul><li>두 벡터(A,B)가 서로 유사할 수록 두 벡터를 이루는 삼각형의 넓이는 줄어듭니다.<li>두 벡터가 완전히 일치하면 삼각형의 넓이는 0입니다.</ul></ul><p><br /></p>\[TS(A,B) = \frac{|A|\, \times |B|\, \times \, sin(\hat{\theta})}{2}\]</ul><p><br /></p><p>하지만 TS도 단점이 존재하는데요.</p><p><br /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post_img/rec_metric.jpeg" alt="rec_metric" /></p><h2 id="metric">Metric</h2><hr /><p>이커머스 도메인에서 추천 시스템의 목적은 무엇일까요? 비즈니스 관점에서 보았을 때 “신규 고객 확보”가 중요한 이커머스 사이트인 경우, CTR과 구매 전환률을 추천 시스템을 통해 올리는 것이 중요할 수 있습니다. 하지만 “고객 충성 유형”에 속하는 이커머스 사이트인 경우 추천 시스템을 통해 단기적인 CTR과 Conversion의 증가를 달성하였지만 장기적인 측면에서 보았을 때 고객 경험이 현저히 떨어지므로 가장 최악의 상황인 완전 이탈을 경험할 수도 있을 것입니다. <strong>이렇게 정답이 없어 보이는 추천 문제에 맥락을 부여하여 해답을 찾으려는 여러 연구자들이 존경스럽네요.</strong> 도메인과 자신의 조직이 처한 상황에 따라 추천의 목적이 다르고 목적에 따라서 추천을 평가하는 지표를 선택하는 과정은 목적을 함축하므로 굉장히 중요합니다. 서로 다른 관점에 따른 추천 엔진에 관한 지표를 소개하겠습니다.</p><h3 id="online-metric">Online Metric</h3><p><br /></p><ul><li>일반적으로 비즈니스 환경에서 수익 최대화를 위해서 추천 시스템을 도입할 때 얼마만큼 추천 시스템이 고객의 행동에 영향을 주는지 측정하고 싶습니다. 이런 예측은 고객의 문맥이나 의도 그리고 이커머스 도메인의 성격에 따른 다양한 요인들의 결합들에 영향을 받습니다. 이것을 파악하는데 있어 사실 Online Test는 Offline Test에 비해 훨씬 효과적입니다.</ul><p><br /></p><ul><li>이커머스상에서 추천 시스템을 운영할 때 비즈니스 관점에서는 다음을 생각할 수 있습니다.<ul><li>고객이 얼마나 많은 카테고리에 해당하는 상품들을 추천받고 있는가?<li>CTR(Click-through rate)가 추천 엔진을 통해 얼마만큼 증가했는가?<li>구매 전환율(Conversion)이 추천 엔진을 통해 얼마만큼 증가했는가?<li>이커머스 사이트의 매출액이 추천 엔진을 통해 얼마만큼 증가했는가?<li>고객 이탈이 추천 엔진을 통해 얼마만큼 감소했는가?</ul></ul><p><br /></p><ul><li>위와 같이 추천 시스템의 효과를 측정하는 방법과 요소들은 문맥에 따라 상당히 다양합니다.<li>하지만 온라인 테스트를 진행할 때는 일반적으로 전체 고객들 중에서 샘플링한 뒤 추천 엔진의 평가 요소를 단일화해야 합니다.<ul><li>만약 유저의 인터페이스를 평가하고 싶다면 추천 시스템에 사용되는 모델들은 고정해야 합니다.<li>반면 추천 시스템의 모델들을 평가하고 싶다면 추천 시스템를 구성하는 다른 요소들은 고정해야 합니다.</ul></ul><p><br /></p><ul><li>하지만 온라인 테스팅 시스템을 구축하는 데 상당한 시간이 소요됩니다.<li>또한 고객의 반응을 직접적으로 알 수 있는 지점에서 ‘고객의 불만족’을 맞이할 수 있습니다.<ul><li>B2C 업체인 경우 고객의 이탈을 추천 엔진 고도화를 위해 감수할 수도 있습니다.<li>이 점에서 특정 B2B 솔루션 업체인 경우 B2C 업체와는 다르게 검증된 추천 엔진을 제공해야 합니다.</ul><li>그리고 아직 추천 엔진이 도입 전인 경우 Online Test는 힘들 수 있습니다.</ul><p><br /></p><h3 id="offline-metric">Offline Metric</h3><hr /><p>Online Test의 값비싼 비용을 상쇄하기 위해 Offline Test를 현업에서 많이 사용하고 있습니다. Offline Metric을 통한 추천 모델의 평가는 학습 데이터와 테스트 데이터를 분리한 후 학습 데이터를 통해 추천 모델을 학습 시킨 뒤 모델러가 정의한 오차 함수와 테스트 데이터를 통해 모델의 성능 평가하는 방식입니다.</p><p><br /></p><h4 id="accuracy-and-error-based-methods">Accuracy and Error based methods</h4><p>정확도를 기반으로 추천의 성능을 평가하는 지표들 중 몇 가지(MAE(Mean Absolute Error), MSE(Mean Squared Error), RMSE(Root Mean Squared Error)를 살펴보겠습니다. 먼저 각 수식을 전개하면 다음과 같습니다.</p><p><br /></p>\[MAE = \frac{\sum^n_{i=1} \left\lvert x_i - y_i \right\rvert}{n}\]<p><br /></p>\[MSE = \frac{\sum^n_{i=1} (x_i - y_i )^2}{n}\]<p><br /></p>\[RMSE = \sqrt{\frac{\sum^n_{i=1} (x_i - y_i )^2}{n}}\]<p><br /></p><p>RMSE와 MAE는 서로 어떤 장단점을 가질까요?</p><ul><li>MAE는 오차(실제 값과 추천 시스템가 출력한 예측 값간의 차이)에 대한 평균을 의미합니다.<li>RMSE는 오차를 제곱한 값의 평균에 루트를 덧붙였습니다.<li>수식상 RMSE는 MAE에 비해 절대 작을 수 없습니다<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup>.<li>만약 오차값이 극단적으로 클 경우에는 극단치에 편향을 주지 않는 MAE를 선택하여 추천 시스템의 성능을 평가해야 합니다.<li>오차함수에서 절대값을 사용하지 않고 제곱근을 사용하는 RMSE는 MAE에 비해 Gradient나 거리를 계산할 때 수학적으로 훨씬 편리합니다.</ul><p><br /></p><h4 id="decision-support-methods">Decision support methods</h4><p>‘Desicion support methods’는 고객이 좋은 상품을 선택하고 기호품이 아닌 상품을 배제하도록 도울 수 있는 지표입니다. 대표적으로 정밀도(precision)와 재현율(recall)이 있습니다.</p><p><br /></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center"> <th style="text-align: center">Positive Prediction<th style="text-align: center">Negative Prediction<tbody><tr><td style="text-align: center"><strong>Positive Class</strong><td style="text-align: center">TP(True Positive)<td style="text-align: center">FN(False Negative)<tr><td style="text-align: center"><strong>Negative Class</strong><td style="text-align: center">FP(False Positive)<td style="text-align: center">TN(True Negative)</table></div><p><br /></p>\[Precision = \frac {TP}{TP+FP}\]<p><br /></p>\[Recall = \frac {TP}{TP+FN}\]<p><br /></p><ul><li>CTR을 예시로 정밀도와 재현율의 의미를 살펴보겠습니다.<ul><li>정밀도는 클릭할 것으로 예측되는 상품들 중에서 실제로 클릭한 경우를 의미합니다.<li>재현율은 클릭한 상품들 대비 예측 모델이 정확히 클릭할 것으로 예측한 비율을 말합니다.<li>추천 모델의 Output은 일반적으로 고객이 클릭할 가능성이 높은 Top N개의 상품을 리스트 형태로 묶은 형태입니다.<li>분모에 주목해 주세요. “클릭할 것으로 예측 되는 상품수” 에 비해 “고객이 실제로 클릭한 상품수”는 특수한 도메인의 이커머스 사이트를 제외하고 현저히 작을 것입니다.<li>유저가 한 세션에서 두 개의 상품을 클릭한 경우 Recall 값의 경우는 세 가지 밖에 없을 것입니다.<ul><li>0/2[두 개의 상품들 중 하나도 예측 모델이 예측 못한 경우]<li>1/2[두 개의 상품들 중 예측 모델이 하나를 올바로 예측한 경우]<li>2/2[두 개의 상품들 중 예측 모델이 두 개를 올바로 예측한 경우]</ul><li>이런 특성 때문에 추천에서는 재현율 보다는 정밀도를 일반적으로 사용하는 것 같습니다.</ul></ul><p><br /></p><h4 id="ranking-based-methods">Ranking Based Methods</h4><p>‘Accuracy and Error based methods’와 ‘Decision support methods’는 전반적인 추천 시스템의 성능을 평가할 수 있는 지표입니다. 하지만 CTR의 예시에서 알 수 있듯이 추천의 최종 형태는 일반적으로 여러 상품들이 담긴 리스트 형태로 나옵니다. <strong>추천 리스트 안의 순서를 반영하여 평가할 수 있는 지표를 생각해볼 수 있습니다.</strong></p><p><br /></p><h5 id="mrrmean-reciprocal-rank">MRR(Mean reciprocal Rank)</h5><ul><li>MRR은 “가장 관련성이 높은 상품이 추천 상품 셋의 몇 번째에 위치했나”(Binary relevance based metrics)를 알아보는 지표입니다.<li>먼저 MRR을 구할 때 필요한 준비물은 다음과 같습니다.</ul><p><br /></p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">for</span> <span class="n">each</span> <span class="n">user</span> <span class="n">u</span><span class="p">:</span>
	<span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">추천</span> <span class="n">상품</span> <span class="n">리스트</span> <span class="n">생성합니다</span><span class="p">.</span>
	<span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">가장</span> <span class="n">관련</span> <span class="n">있는</span> <span class="n">상품의</span> <span class="n">순서를</span> <span class="n">구합니다</span><span class="p">.</span>
	<span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">두번째</span> <span class="n">과정에서</span> <span class="n">구한</span> <span class="n">순서를</span> <span class="n">역을</span> <span class="n">취합니다</span><span class="p">.</span>
</pre></table></code></div></div><ul><li>구체적인 MRR의 정의는 다음과 같습니다.</ul><p><br /></p>\[MRR(O,U) = \frac{1}{|U|}\sum_{u \in U} \ k_u\]<p><br /></p><p>직관적인 예시를 통해 살펴보겠습니다.</p><p><br /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post_img/MRR_image.png" alt="Mean Reciprocal Rank" /><em>MRR metric example</em></p><p><br /></p><ul><li>이렇게 가장 연관성이 높은 상품에 집중하는 점은 필연적으로 장단점을 만듭니다.<ul><li>계산하고 해석하기 좋은 지표입니다.<li>가장 관련 있는 상품에 집중하는 것은 “나를 위한 최고의 상품”이 목적일 때 가장 최적일 것입니다.<li>반면 상품 추천 리스트의 다양한 상품들을 평가 대상으로 삼을 경우에는 적절하지 않습니다.</ul></ul><p><br /></p><h5 id="mapmean-average-precision">MAP(Mean Average Precision)</h5><ul><li>‘Decision support methods’에서 살펴본 P(Precision)@N은 ‘n개의 추천 상품들 중에서 어느 정도 비율로 상품이 선택되었는지’를 파악할 수 있지만 추천 상품의 순서를 반영하지 않습니다.<li>AP는 다음과 같은 방법으로 계산을 하는데요.</ul><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">for</span> <span class="n">each</span> <span class="n">user</span> <span class="n">u</span><span class="p">:</span>
	<span class="n">추천</span> <span class="n">상품</span> <span class="n">리스트</span> <span class="n">생성합니다</span>
	<span class="k">for</span> <span class="n">each</span> <span class="n">relevant</span> <span class="n">item</span><span class="p">:</span>
		<span class="n">리스트의</span> <span class="n">정밀도를</span> <span class="n">계산합니다</span><span class="p">.</span>
		<span class="n">정밀도의</span> <span class="n">sub</span><span class="o">-</span><span class="n">list에</span> <span class="n">대하여</span> <span class="n">평균을</span> <span class="n">계산합니다</span><span class="p">.</span>
</pre></table></code></div></div><ul><li>최종적으로 user-level의 precision에 대해 평균을 구하면 MAP값이 산출됩니다.<ul><li>사실 진정한 AP의 매력은 PR-curve의 면적을 구하는 것입니다.<li>하지만 plot 형태의 지표는 해석하고 계산하기 불편합니다.<li>그래서 정확하지 않지만 축약할 수 있는 평균으로 연구자들이 지표를 대체한 것 같네요.</ul><li>다른 지표와 마찬가지로 예시를 통해 쉽게 파악해 보겠습니다.</ul><p><br /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post_img/MAP_example.png" alt="MAP example" /><em>MAP metric example</em></p><p><br /></p><ul><li>MRR이 가장 관련성 있는 첫번째 상품에 초점을 맞춘것과는 다르게 MAP는 전체 추천 상품 리스트를 다룹니다.<li>추천리스트 중에서 높은 순위에 배치된 상품들에는 더 높은 오류 가중치를 부여합니다.<li>MRR과 마찬가지로 “Binary relevance based metrics”에 속하므로 관련이 있는 상품과 관련성이 없는 상품으로 미리 데이터를 전처리 해야 합니다.<li>다양한 수치형값들이 존재할 때 이 값들을 임의적으로 데이터를 이진화하는 과정에서 정보의 편향이 발생하네요.</ul><p><br /></p><h5 id="ndcg">nDCG</h5><ul><li>nDCG는 세 부분으로 구성됩니다.<ul><li>CG(Cumulative Gains) : 관련성(Relevancy)을 기준으로 상품들을 수치화한 후 더합니다.<ul><li>정의에서 알 수 있듯이 가장 관련 있는 상품이 상대적으로 관련성이 작은 상품에 비해 높은 점수를 받습니다.<li>하지만 밑의 수식에서 알 수 있듯이 아직까지 ‘CG’ 자체는 추천 리스트의 순서를 반영한 지표가 아닙니다.</ul><p><br /></p>\[CG(Cumulative \ Gains) = \sum^p_{i=1} \ rel_i\]<p><br /></p><li>상품의 관련성을 정량화한 것은 살리면서 동시에 상품 추천 리스트에서 낮은 순위로 등장하는 상품들에 페널티를 주는 방법을 생각해 볼 수 있는데요.<li>구체적으로 상품의 관련성 지표값을 추천 리스트에 등장한 순서로 나눌 수 있을 것입니다.<li><p>DCG(Discounted Cumulative Gain)의 수식을 한번 보겠습니다.</p><p><br /></p>\[DCG(Discounted \ Cumulative \ Gains) = \sum^p_{i=1} \ \frac{2^{rel_i}-1}{log_2{(i+1)}}\]<p><br /></p><li>하지만 추천 리스트의 길이 자체가 다를 경우는 어떻게 대응해야 할까요?<ul><li>예를 들어 30개의 상품 추천 셋에서 가장 관련도가 높은 상품이 5번째 배치될 때와 15개의 상품 추천 셋에서 관련도가 가장 높은 상품이 5번째 놓였을 때의 ‘DCG’는 어떨까요?<li>n(추천 상품의 리스트 수)를 정규화할 필요가 있어 보입니다.</ul><p><br /></p>\[IDCG_p = \sum^{|REL_p|}_{i=1} \ \frac{2^{rel_i}-1}{log_2{(i+1)}}\]<p><br /></p><p><br /></p>\[nDCG_p = \frac{DCG_p}{IDCG_p}\]<p><br /></p></ul><li>예시를 통해 확인해 볼까요?</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post_img/ndcg_metric_example.png" alt="nDCG example" /><em>ndcg_metric_example</em></p><p><br /></p><h2 id="글을-마치면서">글을 마치면서..</h2><hr /><p><br /></p><blockquote><p>지금까지 이커머스 추천 모델에서 마지막 부분에 속하는 유사도와 지표를 살펴보았습니다. 지면에 기술하지 않았지만 이커머스에서 추천 시스템을 도입할 때 수 많은 요소들(i.e.비즈니스에서 가장 중요한 KPI 결정하기, 고객의 행동 심리학적 요소들)을 고려해야 합니다. 그리고 무엇보다 최근 고객의 이커머스상의 행동 패턴은 오프라인에서의 행동 패턴과는 다르게 비선형적이고 굉장히 복잡해 지고 있습니다. 그래서 ‘온사이트와 오프사이트 상에서 고객의 행동 패턴을 정교하게 정량화하고 연결하여 모델에 어떻게 반영하느냐’가 앞으로 중요한 문제가 될 것 같습니다. 이런 점들이 추천 태스크를 정말 어렵게 하지만 사람의 반응을 즉각 확인할 수 있다는 점에서 매우 흥미롭기도 합니다.</p></blockquote><p><br /></p><h2 id="reference">Reference</h2><hr /><ul><li><a href="https://gmd.copernicus.org/articles/7/1247/2014/gmd-7-1247-2014.pdf">Arguments against avoiding RMSE in the literature</a><li><a href="https://mathbitsnotebook.com/Geometry/Similarity/SMProofs.html">Side-Angle-Side Proof</a><li><a href="https://ieeexplore.ieee.org/document/7474366/references#references">A Hybrid Geometric Approach for Measuring Similarity Level Among Documents and Document Clustering</a><li><a href="https://towardsdatascience.com/evaluating-recommender-systems-root-means-squared-error-or-mean-absolute-error-1744abc2beac">Evaluating Recommender Systems: Root Means Squared Error or Mean Absolute Error?</a><li><a href="https://towardsdatascience.com/what-does-rmse-really-mean-806b65f2e48e">What does RMSE really mean?</a><li><a href="https://medium.com/swlh/rank-aware-recsys-evaluation-metrics-5191bba16832">MRR vs MAP vs NDCG: Rank-Aware Evaluation Metrics And When To Use Them</a><li><a href="https://sdsawtelle.github.io/blog/output/mean-average-precision-MAP-for-recommender-systems.html">Mean Average Precision (MAP) For Recommender Systems</a><li><a href="https://www.researchgate.net/publication/307573366_Contrasting_Offline_and_Online_Results_when_Evaluating_Recommendation_Algorithms">Contrasting Offline and Online Results when Evaluating Recommendation Algorithms</a><li><a href="https://www.jmlr.org/papers/volume10/gunawardana09a/gunawardana09a.pdf">A Survey of Accuracy Evaluation Metrics of Recommendation Tasks</a></ul><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p><a href="https://www.researchgate.net/publication/27382630_Applying_SVD_on_Item-based_Filtering">Applying SVD on item based filtering</a> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:2" role="doc-endnote"><p><a href="http://yifanhu.net/PUB/cf.pdf">Collaborative Filtering for Implicit Feedback Datasets</a> <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:3" role="doc-endnote"><p><a href="https://classicmania.github.io/posts/User2userItem2Item/">User2User and Item2Item</a> <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p><li id="fn:4" role="doc-endnote"><p><a href="https://gmd.copernicus.org/articles/7/1247/2014/gmd-7-1247-2014.pdf">Root mean square error (RMSE) or mean absolute error (MAE)?</a> <a href="#fnref:4" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/recommendation/'>Recommendation</a>, <a href='/categories/basic/'>Basic</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/recommendation/" class="post-tag no-text-decoration" >Recommendation</a> <a href="/tags/similarity/" class="post-tag no-text-decoration" >Similarity</a> <a href="/tags/metrics/" class="post-tag no-text-decoration" >Metrics</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Recommendation system for E-commerce / Similarity and Metrics - Kwon_sun_cheol&url=https://classicmania.github.io/posts/Similarityandmetrics/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Recommendation system for E-commerce / Similarity and Metrics - Kwon_sun_cheol&u=https://classicmania.github.io/posts/Similarityandmetrics/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Recommendation system for E-commerce / Similarity and Metrics - Kwon_sun_cheol&url=https://classicmania.github.io/posts/Similarityandmetrics/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/User2userItem2Item/"><div class="card-body"> <span class="timeago small" > Mar 21 <i class="unloaded">2021-03-21T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Recommendation system for E-commerce / Collaborative Filtering</h3><div class="text-muted small"><p> 현재 추천 시스템이 적용되고 있고 고도화를 진행하고 있는 시점에서 최근 팀원분들과 추천 스터디를 플립러닝(flipped learning) 방식으로 진행하게 되었습니다. 우선 팀원들과 함께 추천의 내재적인 부분과 기본적인 내용들을 확인하고 놓칠 수 있는 부분들을 점검하고 있습니다. 이번주는 팀원들과 함께 중소형 트래픽 규모를 가...</p></div></div></a></div><div class="card"> <a href="/posts/SparkTuningPart1/"><div class="card-body"> <span class="timeago small" > Feb 21 <i class="unloaded">2021-02-21T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spark Tuning과 관련된 몇 가지 발견들</h3><div class="text-muted small"><p> 최근에 고객 세분화(Customer Segmentation) RFM 모델 디버깅 작업과 팀원 중 한분께서 Session Based RS를 고안하실 때 필요한 순차 데이터(Sequential Data) 전처리 작업을 스파크로 진행하면서 경험하였던 것들 중 몇 가지를 공유하고자 합니다. Spark Tuning 몇 가지 전제들 ‘Data...</p></div></div></a></div><div class="card"> <a href="/posts/Imbalanced_classification_part2/"><div class="card-body"> <span class="timeago small" > Jan 24 <i class="unloaded">2021-01-24T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Imbalanced data classification part2</h3><div class="text-muted small"><p> 지난 포스트에 이어서 고객의 이탈 유무와 LTV를 예측하는 태스크를 진행할 때 ‘불균형 데이터를 어떻게 다룰 것인가’에 관하여 숙고하였던 내용을 다루겠습니다. 불균형 데이터는 데이터 자체의 크기, 노이즈를 유발하는 데이터, 왜도가 높은 데이터 분포 문제와 관련이 깊습니다. 지난 포스트에서 우리는 명쾌한 클래스의 분류(Ex : 이탈 또는 비...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/User2userItem2Item/" class="btn btn-outline-primary"><p>Recommendation system for E-commerce / Collaborative Filtering</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/classicmania">Kwon_suncheol</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/similarity/">Similarity</a> <a class="post-tag" href="/tags/recommendation/">Recommendation</a> <a class="post-tag" href="/tags/imbalanced_data/">Imbalanced_data</a> <a class="post-tag" href="/tags/evaluation_metric/">Evaluation_metric</a> <a class="post-tag" href="/tags/data_sampling/">Data_sampling</a> <a class="post-tag" href="/tags/classification/">Classification</a> <a class="post-tag" href="/tags/churn_prediction/">Churn_prediction</a> <a class="post-tag" href="/tags/stack/">stack</a> <a class="post-tag" href="/tags/queue/">queue</a> <a class="post-tag" href="/tags/linked_list/">linked_list</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://classicmania.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
